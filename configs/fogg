upstream fogg {
    server localhost:4200;
}

upstream fogg_api {
    server localhost:8000;
}


server {
    listen   80;
    server_name fogg.ibizit.nl map.ibizit.nl fogg.cloud.tilaa.com;

    client_max_body_size    4G;
    keepalive_timeout       5;

    expires                 12h;

    access_log  /var/log/nginx/fogg_access.log;
    error_log  /var/log/nginx/fogg_error.log;

    gzip            on;
    gzip_min_length 1000;
    gzip_proxied    expired no-cache no-store private auth;
    gzip_types      text/plain application/xml;

    satisfy any;
    location /static {
        alias /var/www/fogg/api/static;
        access_log off;
        expires 1M;
    }

    root /var/www/;

    location / {
	proxy_set_header    Access-Control-Allow-Origin *;
        proxy_redirect      off;
        proxy_set_header    Host                $host;
        proxy_set_header    X-Real-IP           $remote_addr;
        proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto   https;
        proxy_set_header    X-Scheme            $scheme;
        proxy_pass          http://fogg;
    }

    location /api {
	proxy_set_header    Access-Control-Allow-Origin *;
        proxy_redirect      off;
        proxy_set_header    Host                $host;
        proxy_set_header    X-Real-IP           $remote_addr;
        proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto   https;
        proxy_set_header    X-Scheme            $scheme;
	proxy_pass          http://fogg_api/api;
    }
    location /geojson {
	proxy_set_header    Access-Control-Allow-Origin *;
        proxy_redirect      off;
        proxy_set_header    Host                $host;
        proxy_set_header    X-Real-IP           $remote_addr;
        proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto   https;
        proxy_set_header    X-Scheme            $scheme;
	proxy_pass          http://fogg_api/geojson;

        expires 1M;
        access_log off;
        add_header Cache-Control "public";
    }

    location /admin {
	proxy_set_header    Access-Control-Allow-Origin *;
        proxy_redirect      off;
        proxy_set_header    Host                $host;
        proxy_set_header    X-Real-IP           $remote_addr;
        proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Proto   https;
        proxy_set_header    X-Scheme            $scheme;
	proxy_pass          http://fogg_api/admin;
    }

    location /api@wsgi {
	proxy_set_header    Access-Control-Allow-Origin *;
        proxy_pass          http://fogg;
        proxy_redirect      off;
        proxy_set_header    Host                $host;
        proxy_set_header    X-Real-IP           $remote_addr;
        proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;
        proxy_set_header    X-Scheme            $scheme;
    }
}

